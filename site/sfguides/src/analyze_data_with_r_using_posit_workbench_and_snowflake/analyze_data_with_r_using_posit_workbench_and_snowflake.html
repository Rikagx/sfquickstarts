<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>analyze_data_with_r_using_posit_workbench_and_snowflake</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/clipboard/clipboard.min.js"></script>
<script src="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/quarto-html/quarto.js"></script>
<script src="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/quarto-html/popper.min.js"></script>
<script src="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/quarto-html/anchor.min.js"></script>
<link href="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analyze_data_with_r_using_posit_workbench_and_snowflake_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<p>author: Daniel Chen id: analyze_data_with_r_using_posit_workbench_and_snowflake summary: Analyze Data with R using Posit Workbench and Snowflake categories: Getting-Started environments: web status: Published feedback link: https://github.com/Snowflake-Labs/sfguides/issues tags: Getting Started, Data Science, R, Posit Workbench, Native Applications</p>
<section id="analyze-data-with-r-using-posit-workbench-and-snowflake" class="level1">
<h1>Analyze Data with R using Posit Workbench and Snowflake</h1>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>Duration: 1</p>
<p>This guide will show you how to use the R language to analyze data stored in Snowflake. It will take you through the process of setting up an R environment in an RStudio Pro IDE, which comes with the Posit Workbench Native App in Snowflake. It will also show you how to use R’s <code>{dbplyr}</code> interface to translate R code into SQL where it can be run within a Snowflake database, which is an environment that provides more memory and compute power than the typical R environment.</p>
<p>We will explore a financial service use case of analyzing web traffic to identify market opportunities.</p>
<p>First, we will procure free data from the Snowflake Marketplace and load it into Snowflake. The data contains metrics collected by the Web Traffic Foundation and made available by Cybersyn. We will then launch an R session and access the data from R, where we will clean, transform, and plot the data, preparing both an HTML report and an interactive Shiny app of our analysis. We will also demonstrate how to write into a Snowflake database from R. In this way, the guide will show you how to do an end-to-end R analysis <em>entirely within Snowflake</em>.</p>
<p><img src="assets/overview/architecture.png" class="img-fluid"></p>
<section id="what-youll-need" class="level3">
<h3 class="anchored" data-anchor-id="what-youll-need">What You’ll Need</h3>
<ul>
<li>Familiarity with R</li>
<li>A Posit Workbench <a href="https://posit.co/pricing/">Advanced</a> tier license file</li>
<li>The Posit Workbench Native Application must be installed in your Snowflake account by an administrator with the <code>ACCOUNTADMIN</code> role. For installation instructions please see the <a href="https://docs.posit.co/ide/server-pro/2024.08.0/integration/snowflake/native-app/">Workbench Native App Admin Guide</a>.</li>
</ul>
</section>
<section id="what-youll-learn" class="level3">
<h3 class="anchored" data-anchor-id="what-youll-learn">What You’ll Learn</h3>
<ul>
<li>How to create an R session within the RStudio Pro IDE that comes with the Posit Workbench Native App</li>
<li>How to connect to your Snowflake data from R to create tables, visualizations, and more</li>
</ul>
</section>
<section id="what-youll-build" class="level3">
<h3 class="anchored" data-anchor-id="what-youll-build">What You’ll Build</h3>
<ul>
<li>An RStudio Pro IDE environment to use within Snowflake</li>
<li>A Quarto document that contains plots and tables built with R, using data available in the Snowflake Marketplace.</li>
<li>An interactive Shiny Application built with R, using data available in the Snowflake Marketplace</li>
</ul>
<p>Along the way, you will use R to analyze trends in web traffic for the websites of large corporations. You can follow along with this quickstart guide, or look at the materials provided in the accompanying repository: <a href="https://github.com/posit-dev/snowflake-posit-quickstart-r" class="uri">https://github.com/posit-dev/snowflake-posit-quickstart-r</a>.</p>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Duration: 3</p>
<p>Before we begin there are a few components we need to get ready. We need to:</p>
<ul>
<li>Get our data from the Snowflake Marketplace</li>
<li>Launch the Posit Workbench Native App</li>
<li>Create an RStudio Pro IDE session</li>
<li>Install R Packages</li>
</ul>
<section id="get-our-data-from-the-snowflake-marketplace" class="level3">
<h3 class="anchored" data-anchor-id="get-our-data-from-the-snowflake-marketplace">Get our data from the Snowflake Marketplace</h3>
<p>For this analysis, we will use the <code>Web Traffic Foundation (Experimental)</code> database from Cybersyn, which is available for free in the Snowflake Marketplace.</p>
<section id="step-1-navigate-to-the-marketplace" class="level4">
<h4 class="anchored" data-anchor-id="step-1-navigate-to-the-marketplace">Step 1: Navigate to the Marketplace</h4>
<p>In your Snowflake account, Go to <code>Data Products</code> &gt; <code>Marketplace</code> to open the marketplace.</p>
<p><img src="assets/snowflake/01-data_marketplace.png" class="img-fluid"></p>
</section>
<section id="step-2-search-for-the-data" class="level4">
<h4 class="anchored" data-anchor-id="step-2-search-for-the-data">Step 2: Search for the Data</h4>
<p>You can search for <code>cybersyn</code> and look for the <code>Web Traffic Foundation (Experimental)</code> database.</p>
<p><img src="assets/snowflake/02-search_cybersyn.png" class="img-fluid"></p>
</section>
<section id="step-3-add-the-database-to-your-snowflake-account" class="level4">
<h4 class="anchored" data-anchor-id="step-3-add-the-database-to-your-snowflake-account">Step 3: Add the Database to Your Snowflake Account</h4>
<p>Once your find the database, you can load it into your Snowflake account by clicking the Get button on the right-hand side.</p>
<p><img src="assets/snowflake/03-cybersyn_webtraffic_install.png" class="img-fluid"></p>
</section>
<section id="step-4-confirm-database" class="level4">
<h4 class="anchored" data-anchor-id="step-4-confirm-database">Step 4: Confirm Database</h4>
<p>If everything is set up properly, you should see the database by navigating to: <code>Data</code> &gt; <code>Database</code>. The database will appear as <code>WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL</code>. The tables we will use are available in the <code>CYBERSYN</code> schema. You can see the tables (views) under the <code>Views</code> dropdown.</p>
<p><img src="assets/snowflake/04-installed_database.png" class="img-fluid"></p>
<p>Cybersyn makes its data available as views. We will be mostly working with the <code>WEBTRAFFIC_SYNDICATE_TIMESERIES</code> view. We also need the <code>WEBTRAFFIC_SYNDICATE_ATTRIBUTES</code> view so we can work with the type of count data easier.</p>
<blockquote class="blockquote">
<p>A “view” is a saved SQL query that returns a table. Think of it as a way to save a SQL query and have it masquerade around like a table.</p>
</blockquote>
</section>
</section>
<section id="launch-posit-workbench" class="level3">
<h3 class="anchored" data-anchor-id="launch-posit-workbench">Launch Posit Workbench</h3>
<p>We can then start our data exploration using Posit Workbench. You can find Posit Workbench as a Snowflake Native Application, and use it to connect to your database.</p>
<section id="step-1-navigate-to-apps" class="level4">
<h4 class="anchored" data-anchor-id="step-1-navigate-to-apps">Step 1: Navigate to Apps</h4>
<p>In your Snowflake account, Go to <code>Data Products</code> &gt; <code>Apps</code> to open the Native Apps collection. If Posit Workbench is not already installed, click <code>Get</code>.</p>
<p><img src="assets/snowflake/05-get_posit_workbench.png" class="img-fluid"></p>
</section>
<section id="step-2-open-the-posit-workbench-native-app" class="level4">
<h4 class="anchored" data-anchor-id="step-2-open-the-posit-workbench-native-app">Step 2: Open the Posit Workbench Native App</h4>
<p>Once Posit Workbench is installed, click on the app under <code>Installed Apps</code> to launch the app. If you do not see the Posit Workbench app listed, ask you Snowflake account administrator for access to the app.</p>
<p><img src="assets/snowflake/06-open_app.png" class="img-fluid"></p>
<p>After clicking on the app, you will see a page with configuration instructions and a blue <code>Launch app</code> button.</p>
<p><img src="assets/snowflake/09-launch-app.png" class="img-fluid"></p>
<p>Click on the app. This should take you to the webpage generated for the Workbench application. You may be prompted to first login to Snowflake using your regular credentials or authentication method.</p>
<p><img src="assets/snowflake/10-login.png" class="img-fluid"></p>
</section>
</section>
<section id="create-an-rstudio-pro-session" class="level3">
<h3 class="anchored" data-anchor-id="create-an-rstudio-pro-session">Create an RStudio Pro Session</h3>
<p>Posit Workbench provides several IDEs, such as RStudio Pro, JupyterLab, and VS Code. For this analysis we will use an RStudio Pro IDE.</p>
<section id="step-1-new-session" class="level4">
<h4 class="anchored" data-anchor-id="step-1-new-session">Step 1: New Session</h4>
<p>Within Posit Workbench, click <code>New Session</code> to launch a new session to spin up your coding environment.</p>
<p><img src="assets/posit_workbench/01-start_new_session.png" class="img-fluid"></p>
</section>
<section id="step-2-select-an-ide" class="level4">
<h4 class="anchored" data-anchor-id="step-2-select-an-ide">Step 2: Select an IDE</h4>
<p>When prompted, select the RStudio Pro IDE.</p>
<p><img src="assets/posit_workbench/02-create_new_session_snowflake.png" class="img-fluid"></p>
</section>
<section id="step-3-log-into-your-snowflake-account" class="level4">
<h4 class="anchored" data-anchor-id="step-3-log-into-your-snowflake-account">Step 3: Log into your Snowflake account</h4>
<p>Next, connect to your Snowflake account from within Posit Workbench. Click on <code>Sign In</code> in the Snowflake section, and follow the sign in prompts.</p>
<p><img src="assets/posit_workbench/03-snowflake_login.png" class="img-fluid"></p>
</section>
<section id="step-4-launch-the-rstudio-pro-ide" class="level4">
<h4 class="anchored" data-anchor-id="step-4-launch-the-rstudio-pro-ide">Step 4: Launch the RStudio Pro IDE</h4>
<p>When the Snowflake authentication is successful, you will be able to start your session. Otherwise, the <code>Start Session</code> button will be greyed out.</p>
<p>Once everything is ready, you will be able to work with your Snowflake data in the familiar RStudio Pro IDE. Since the IDE is provided by the Posit Workbench Native App, your entire analysis will occur securely within Snowflake.</p>
<p><img src="assets/rstudio/01-rstudio.png" class="img-fluid"></p>
</section>
<section id="step-5-access-the-quickstart-materials" class="level4">
<h4 class="anchored" data-anchor-id="step-5-access-the-quickstart-materials">Step 5: Access the Quickstart Materials</h4>
<p>This Quickstart will step you through the analysis contained in <a href="https://github.com/posit-dev/snowflake-posit-quickstart-r/blob/main/quarto.qmd" class="uri">https://github.com/posit-dev/snowflake-posit-quickstart-r/blob/main/quarto.qmd</a>. To follow along, open the file in your RStudio Pro IDE. You could do this by:</p>
<ol type="1">
<li><p><strong>Simple copy-and-paste</strong> Go to File &gt; New File &gt; Quarto Document and then copy the contents of <a href="https://github.com/posit-dev/snowflake-posit-quickstart-r/quarto.qmd">quarto.qmd</a> into your new file.</p></li>
<li><p><strong>Starting a new project linked to the github repo.</strong> To do this:</p>
<ol type="1">
<li>Go to File &gt; New Project in the RStudio IDE menu bar.</li>
</ol>
<p><img src="assets/rstudio/03-new-project.png" class="img-fluid"></p>
<ol start="2" type="1">
<li>Select Version Control in the New Project Wizard</li>
</ol>
<p><img src="assets/rstudio/04-project-wizard.png" class="img-fluid"></p>
<ol start="3" type="1">
<li>Select Git</li>
</ol>
<p><img src="assets/rstudio/05-git.png" class="img-fluid"></p>
<ol start="4" type="1">
<li>Paste the <a href="">URL</a> of the github repo and click Create Project</li>
</ol>
<p><img src="assets/rstudio/06-create-project.png" class="img-fluid"></p>
<p>RStudio will clone a local copy of the materials on github. You can use the Files pane in the bottom right-hand corner of the IDE to navigate to <code>quarto.qmd</code>. Click on the file to open it.</p></li>
</ol>
</section>
</section>
<section id="install-r-packages" class="level3">
<h3 class="anchored" data-anchor-id="install-r-packages">Install R Packages</h3>
<p>Now that we’re in a familiar R environment, we need to prepare the packages we will use. For this analysis, we will use the <a href="https://www.tidyverse.org/">Tidyverse</a> suite of packages, as well as a few others.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"DBI"</span>, <span class="st">"dbplyr"</span>, <span class="st">"gt"</span>, <span class="st">"gtExtras"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will also use the development version of the <code>{odbc}</code> package to connect to the Snowflake database.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"pak"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pak<span class="sc">::</span><span class="fu">pak</span>(<span class="st">"r-dbi/odbc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After we install the packages, we load them.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtExtras)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(odbc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="access-snowflake-data-from-r" class="level2">
<h2 class="anchored" data-anchor-id="access-snowflake-data-from-r">Access Snowflake data from R</h2>
<p>Duration: 5</p>
<p>We will run our code in the R environment created by the RStudio Pro IDE, but the code will use data stored in the <code>WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL</code> database on Snowflake.</p>
<p>To access this data, we will use the <code>{DBI}</code> and <code>{odbc}</code> R packages to connect to the database. We will then use <code>{dplyr}</code> and <code>{dbplyr}</code> to query the data with R, without having to write raw SQL. Let’s take a look at how this works.</p>
<section id="connect-with-dbi" class="level3">
<h3 class="anchored" data-anchor-id="connect-with-dbi">Connect with <code>{DBI}</code></h3>
<p><code>{DBI}</code> is an a R package that allows us to connect to databases with <code>DBI::dbConnect()</code>.</p>
<p>To connect to our Snowflake database, we will use a driver provided by the <code>{odbc}</code> package. We will need to provide a <code>warehouse</code> for compute, and a <code>database</code> to connect to. We can also provide a <code>schema</code> here to make connecting to specific tables and views easier.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to the database</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  DBI<span class="sc">::</span><span class="fu">dbConnect</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">drv =</span> odbc<span class="sc">::</span><span class="fu">snowflake</span>(),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">warehouse =</span> <span class="st">"DEVREL_WH_LARGE"</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">database =</span> <span class="st">"WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">schema =</span> <span class="st">"CYBERSYN"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will save our connection as an object, named <code>conn</code>, which will make it easy to use.</p>
<p>Once we build a connection, we can see the databases, schemas, and tables available to us in the RStudio IDE Connections pane. Click on the database icon to the right of a database to see its schemas. Click on the schema icon to the right of a schema to see its tables. Click on the table icon to the right of a table to see a preview of the table.</p>
<p><img src="assets/rstudio/02-connections.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>The Connections pane displays the tables in a schema, but not the <em>views</em> associated with those tables. Since Cybersyn provides its data as views, they will not appear here.</p>
</blockquote>
</section>
<section id="create-tbls-that-correspond-to-tables-in-the-database" class="level3">
<h3 class="anchored" data-anchor-id="create-tbls-that-correspond-to-tables-in-the-database">Create <code>tbl</code>s that correspond to tables in the database</h3>
<p>Once we build a connection, we can use <code>dplyr::tbl()</code> to create <code>tbl</code>s. A tbl is an R object that represents a table or view accessed through a connection.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>timeseries <span class="ot">&lt;-</span> <span class="fu">tbl</span>(conn, <span class="st">"WEBTRAFFIC_SYNDICATE_TIMESERIES"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>attributes <span class="ot">&lt;-</span> <span class="fu">tbl</span>(conn, <span class="st">"WEBTRAFFIC_SYNDICATE_ATTRIBUTES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>If we did not provide the <code>schema</code> argument into <code>DBI::dbConnect()</code> earlier, we would need to specify the view with <code>tbl(conn, in_schema("CYBERSYN", "WEBTRAFFIC_SYNDICATE_TIMESERIES"))</code>.</p>
</blockquote>
</section>
<section id="rely-on-dbplyr-to-translate-r-to-sql" class="level3">
<h3 class="anchored" data-anchor-id="rely-on-dbplyr-to-translate-r-to-sql">Rely on <code>{dbplyr}</code> to translate R to SQL</h3>
<p>We can now use <code>timeseries</code> and <code>attributes</code> as if they were tibbles in R. For example, we can filter rows and select columns from our data.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>facebook <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  timeseries <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    DOMAIN_ID <span class="sc">==</span> <span class="st">"facebook.com"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    lubridate<span class="sc">::</span><span class="fu">month</span>(DATE) <span class="sc">==</span> <span class="dv">5</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE, VARIABLE_NAME, VALUE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When we use <code>tbl</code>s, <code>{dbplyr}</code> translates our R code into SQL queries. Think of any object made downstream from a tbl like a view: it contains SQL that represents a table built from the tbl. If we want to see the SQL code that <code>{dbplyr}</code> generates, we can run <code>dbplyr::show_query()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>facebook <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>SELECT "DATE", "VARIABLE_NAME", "VALUE"
FROM "WEBTRAFFIC_SYNDICATE_TIMESERIES"
WHERE ("DOMAIN_ID" = 'facebook.com') AND (EXTRACT('month', "DATE") = 5.0)</code></pre>
<p>To save compute, R waits to execute a query until we request the data that it represents.</p>
<p>To save memory, R stores the data as a temporary file in the database (instead of in R’s global environment). When we inspect the data, R only returns the first few rows of this file to display.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>facebook</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code># Source:   SQL [?? x 3]
# Database: Snowflake 8.16.0[@Snowflake/WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL]
   DATE       VARIABLE_NAME                                                          VALUE
   &lt;date&gt;     &lt;chr&gt;                                                                  &lt;dbl&gt;
 1 2021-05-02 Sessions (Count) | Week | All Devices | Model version 2024.01.25 10016599466
 2 2021-05-09 Sessions (Count) | Week | All Devices | Model version 2024.01.25 10024864464
 3 2021-05-16 Sessions (Count) | Week | All Devices | Model version 2024.01.25  9948687298
 4 2021-05-23 Sessions (Count) | Week | All Devices | Model version 2024.01.25  9913216616
 5 2021-05-30 Sessions (Count) | Week | All Devices | Model version 2024.01.25  9886247565
 6 2022-05-01 Sessions (Count) | Week | All Devices | Model version 2024.01.25 12502175558
 7 2022-05-08 Sessions (Count) | Week | All Devices | Model version 2024.01.25 12140393116
 8 2022-05-15 Sessions (Count) | Week | All Devices | Model version 2024.01.25 12446181861
 9 2022-05-22 Sessions (Count) | Week | All Devices | Model version 2024.01.25 12436995354
10 2022-05-29 Sessions (Count) | Week | All Devices | Model version 2024.01.25 12418458176
# ℹ more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</section>
<section id="collect" class="level3">
<h3 class="anchored" data-anchor-id="collect"><code>collect()</code></h3>
<p>We can trigger R to execute a query and to return the <em>entire</em> result as a tibble with <code>dbplyr::collect()</code>. Keep in mind, that if your result is large, you may not want to collect it into R.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>facebook <span class="sc">|&gt;</span> <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code># A tibble: 42 × 3
   DATE       VARIABLE_NAME                                                            VALUE
   &lt;date&gt;     &lt;chr&gt;                                                                    &lt;dbl&gt;
 1 2021-05-02 Pageviews (Count) | Week | All Devices | Model version 2024.01.25  39917694787
 2 2021-05-09 Pageviews (Count) | Week | All Devices | Model version 2024.01.25  40870514816
 3 2021-05-16 Pageviews (Count) | Week | All Devices | Model version 2024.01.25  41073679841
 4 2021-05-23 Pageviews (Count) | Week | All Devices | Model version 2024.01.25  41184673335
 5 2021-05-30 Pageviews (Count) | Week | All Devices | Model version 2024.01.25  41837064266
 6 2022-05-01 Pageviews (Count) | Week | All Devices | Model version 2024.01.25  99321575179
 7 2022-05-08 Pageviews (Count) | Week | All Devices | Model version 2024.01.25  98206319156
 8 2022-05-15 Pageviews (Count) | Week | All Devices | Model version 2024.01.25 101792763304
 9 2022-05-22 Pageviews (Count) | Week | All Devices | Model version 2024.01.25 102066608868
10 2022-05-29 Pageviews (Count) | Week | All Devices | Model version 2024.01.25 103002669500
# ℹ 32 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</section>
<section id="in-summary" class="level3">
<h3 class="anchored" data-anchor-id="in-summary">In summary</h3>
<p>This system:</p>
<ol type="1">
<li>Keeps our data in the database, saving memory in the R session</li>
<li>Pushes computations to the database, saving compute in the R session</li>
<li>Evaluates queries lazily, saving compute in the database</li>
</ol>
<p>We don’t need to manage the process, it happens automatically behind the scenes.</p>
<blockquote class="blockquote">
<p><code>{dbplyr}</code> can translate the most common tidyverse and base R functions to SQL. However, you may sometimes use a function that <code>{dbplyr}</code> does not recognize or for which there is no SQL analogue. On these occasions, you will need to <code>collect()</code> your data into R, where you can process it as a real tibble.</p>
</blockquote>
<p>Learn more about <code>{dbplyr}</code> at <a href="https://dbplyr.tidyverse.org/">dbplyr.tidyverse.org</a></p>
</section>
</section>
<section id="write-to-a-snowflake-database" class="level2">
<h2 class="anchored" data-anchor-id="write-to-a-snowflake-database">Write to a Snowflake database</h2>
<p>Duration: 1</p>
<p>You can also use <code>{DBI}</code> to create a new table in a database or append to an existing table.</p>
<p>To add a new table, use <code>DBI::dbWriteTable()</code>. The Cybersyn database doesn’t allow creating new tables, but the following code demonstrates how we would add a data frame <code>df</code> to a different connection.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(conn2, <span class="at">name =</span> <span class="st">"new_table"</span>, <span class="at">value =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To append to an existing table, specify <code>append = TRUE</code>. If appending, <code>name</code> should specify an existing table.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbWriteTable</span>(conn2, <span class="at">name =</span> <span class="st">"existing_table"</span>, <span class="at">value =</span> df, <span class="at">append =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we understand how R will interact with the database, we can use R to perform our analysis.</p>
</section>
<section id="prepare-data-with-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="prepare-data-with-dplyr">Prepare data with <code>{dplyr}</code></h2>
<p>Duration: 5</p>
<p>We want to compare the pageviews, users, and sessions over time for a few popular websites. This information is split between the <code>timeseries</code> and <code>attributes</code> tables. Before we begin, we will need to join and clean the tables.</p>
<p>First we standardize column names, so we won’t need to worry about capitalization.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize column names</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>timeseries <span class="ot">&lt;-</span> timeseries <span class="sc">|&gt;</span> <span class="fu">rename_with</span>(str_to_lower)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>attributes <span class="ot">&lt;-</span> attributes <span class="sc">|&gt;</span> <span class="fu">rename_with</span>(str_to_lower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="combine-tables" class="level3">
<h3 class="anchored" data-anchor-id="combine-tables">Combine Tables</h3>
<p>Then we join the tables, matching rows based on their values of <code>variable</code> and <code>variable_name</code>, which are shared across the tables.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join to make complete table</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>timeseries <span class="ot">&lt;-</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  timeseries <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    attributes,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">join_by</span>(variable, variable_name)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Our combined <code>timeseries</code> table will look like this:</p>
<pre><code>&gt; timeseries
# Source:   SQL [?? x 12]
# Database: Snowflake 8.15.0[@Snowflake/WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL]
   domain_id         geo_id geo_name variable variable_name date        value measure unit  frequency device
   &lt;chr&gt;             &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;         &lt;date&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;
 1 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2021-11-14 3.83e6 Pagevi… Count Week      All D…
 2 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2021-11-21 2.85e7 Pagevi… Count Week      All D…
 3 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2021-11-28 2.61e7 Pagevi… Count Week      All D…
 4 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2021-12-05 3.65e7 Pagevi… Count Week      All D…
 5 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2021-12-12 3.80e7 Pagevi… Count Week      All D…
 6 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2021-12-19 1.38e7 Pagevi… Count Week      All D…
 7 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2021-12-26 2.31e7 Pagevi… Count Week      All D…
 8 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2022-01-02 6.40e6 Pagevi… Count Week      All D…
 9 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2022-01-09 1.72e7 Pagevi… Count Week      All D…
10 larepubliquedesp… World… Worldwi… pagevie… Pageviews (C… 2022-01-16 1.50e7 Pagevi… Count Week      All D…
# ℹ more rows
# ℹ 1 more variable: model_version &lt;chr&gt;
# ℹ Use `print(n = ...)` to see more rowss</code></pre>
</section>
<section id="filter-domains" class="level3">
<h3 class="anchored" data-anchor-id="filter-domains">Filter Domains</h3>
<p>The data contains information about <code>67,671</code> distinct websites, but we are only interested in a few of them. To make our lives easier, we filter the data to just the domains we are interested in. We also reduce the data to just the columns we are interested in.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>top_domains <span class="ot">&lt;-</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"youtube.com"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"google.com"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"facebook.com"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"tiktok.com"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"instagram.com"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"airbnb.com"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"vrbo.com"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lyft.com"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"uber.com"</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>timeseries <span class="ot">&lt;-</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  timeseries <span class="sc">|&gt;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(domain_id <span class="sc">%in%</span> top_domains) <span class="sc">|&gt;</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(domain_id, date, measure, value) <span class="co"># selects columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p><strong><em>INTERACTIVITY NOTE:</em></strong> We are reducing the list of domains here so we can easily compare between a few of the domains. A user may want to choose their own set of domain names to compare.</p>
</blockquote>
</section>
<section id="reshape-the-table" class="level3">
<h3 class="anchored" data-anchor-id="reshape-the-table">Reshape the table</h3>
<p>Finally, to make the table easier to work with, we move values of <code>pageviews</code>, <code>users</code>, and <code>sessions</code> into their own columns.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>timeseries <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  timeseries <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> measure, <span class="at">values_from =</span> value) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(str_to_lower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Our table now looks like this.</p>
<pre><code>&gt; timeseries
# Source:   SQL [?? x 5]
# Database: Snowflake 8.15.0[@Snowflake/WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL]
   domain_id   date          pageviews      users    sessions
   &lt;chr&gt;       &lt;date&gt;            &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
 1 airbnb.com  2022-02-27    171313810   15433961    26568865
 2 youtube.com 2022-07-17 262185037173 2472788560 21915523137
 3 youtube.com 2023-12-17 340737187803 3083645673 32503255500
 4 youtube.com 2023-07-09 236276769477 2857094928 27375541301
 5 youtube.com 2023-10-15 263861379113 2976403065 28240902614
 6 uber.com    2022-08-07      5158044    2189269     2548854
 7 uber.com    2022-08-28      5203070    2024092     2451623
 8 uber.com    2023-06-18      5920585    2244755     3118792
 9 vrbo.com    2022-02-06     45043973    4594557     7508303
10 tiktok.com  2021-07-25  43315325647  817664398  1887858571
# ℹ more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
<blockquote class="blockquote">
<p>When we are running these commands on a data base connection, <code>{dbplyr}</code> is translating the code into SQL for us under the hood. We don’t need to write raw SQL commands, and the compute is happening directly on the database. You can pipe <code>|&gt;</code> the code into <code>show_query()</code> if you want to see the generated SQL query.</p>
</blockquote>
</section>
</section>
<section id="visualize-data-with-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="visualize-data-with-ggplot2">Visualize Data with <code>{ggplot2}</code></h2>
<p>Duration: 5</p>
<p>The Cybersyn data provides signals that can help us:</p>
<ul>
<li>Monitor changes in consumer behavior and market dynamics</li>
<li>Identify web market whitespace and addressable market</li>
<li>Benchmark web performance against peers and competitors</li>
<li>Forecast future demand based on historical web traffic</li>
</ul>
<p>One of the best ways to spot those signals is to visualize the performance of web domains over time.</p>
<section id="visualize-pageviews" class="level3">
<h3 class="anchored" data-anchor-id="visualize-pageviews">Visualize pageviews</h3>
<p>We can use <code>{ggplot2}</code> to visually compare the web traffic of two domains over time. Here we can see that, since 2021, <code>airbnb.com</code> has always been more popular than <code>vrbo.com</code>, but page views for both really started to take off in 2024.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>domains <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"airbnb.com"</span>, <span class="st">"vrbo.com"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>timeseries <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(domain_id <span class="sc">%in%</span> domains) <span class="sc">|&gt;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, pageviews, <span class="at">color =</span> domain_id)) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">""</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Pageviews"</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="assets/analysis/two-domains.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p><strong><em>INTERACTIVITY NOTE:</em></strong> We’ve written the code above to make it simple to visualize other domains. A user can store one or more new values to <code>domains</code> and then rerun the code.</p>
</blockquote>
</section>
</section>
<section id="make-publication-ready-tables-with-gt" class="level2">
<h2 class="anchored" data-anchor-id="make-publication-ready-tables-with-gt">Make publication-ready tables with <code>{gt}</code></h2>
<p>Duration: 5</p>
<p>We can continue to explore our data with visualizations, or we can make a table that concisely displays multiple pieces of information at once. For example, we can use <code>{dplyr}</code> verbs to identify the median number of weekly pageviews, users, and session for our top domains.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>timeseries <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"pageviews"</span>, <span class="st">"users"</span>, <span class="st">"sessions"</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      \(x) <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"avg_{.col}"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code># Source:   SQL [1 x 3]
# Database: Snowflake 8.15.0[@Snowflake/WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL]
  avg_pageviews  avg_users avg_sessions
          &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
1   15814434389 319991480.  1190998470.</code></pre>
<p>With <code>{dplyr}</code>’s <code>group_by()</code> command, we can compute separate metrics for each domain.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  timeseries <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(domain_id) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"pageviews"</span>, <span class="st">"users"</span>, <span class="st">"sessions"</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>      \(x) <span class="fu">median</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">.names =</span> <span class="st">"avg_{.col}"</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">|&gt;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_pageviews))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code># Source:     SQL [9 x 4]
# Database:   Snowflake 8.15.0[@Snowflake/WEB_TRAFFIC_FOUNDATION_EXPERIMENTAL]
# Ordered by: desc(avg_pageviews)
  domain_id     avg_pageviews   avg_users avg_sessions
  &lt;chr&gt;                 &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 google.com    222944428888  3373207378  27864010868.
2 youtube.com   217373542132. 2535250883  22623754428
3 facebook.com  114193789484. 2205116942. 12941002565
4 tiktok.com     50081097228  1105659086.  2691429058.
5 instagram.com  16405246854.  319991480.  1190998470.
6 airbnb.com       312666776.   15437368.    27302062.
7 vrbo.com          36548417     4173328.     6663558.
8 uber.com           5472395     2133430.     2598333
9 lyft.com           5251633     1660472.     2321456</code></pre>
<p>Here we see, among other things, that <code>youtube.com</code> receives almost as many pageviews as google.com, but from a much smaller set of users.</p>
<p>This is a useful way to examine the information for ourselves. However, if we wish to share the information with others, we might prefer to present the table in a more polished format. We can do this with commands from R’s <a href="https://gt.rstudio.com/"><code>{gt}</code> package</a>.</p>
<p>The following code creates a table displaying the information in <code>comparison</code> and highlighting the two domains we investigated in the previous section.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>comparison <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"domain_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">suffixing =</span> <span class="cn">TRUE</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_pageviews =</span> <span class="st">"Pageviews"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_users =</span> <span class="st">"Users"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_sessions =</span> <span class="st">"Sessions"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_highlight_rows</span>(</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> (domain_id <span class="sc">==</span> <span class="st">"airbnb.com"</span>),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#ffce67"</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt_highlight_rows</span>(</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">rows =</span> (domain_id <span class="sc">==</span> <span class="st">"vrbo.com"</span>),</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"#78c2ad"</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="dyuxjdungs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<table class="table">
<colgroup>
<col style="width: 22%">
<col style="width: 16%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Pageviews</th>
<th style="text-align: right;">Users</th>
<th style="text-align: right;">Sessions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">google.com</td>
<td style="text-align: right;">221B</td>
<td style="text-align: right;">3B</td>
<td style="text-align: right;">28B</td>
</tr>
<tr class="even">
<td style="text-align: left;">youtube.com</td>
<td style="text-align: right;">219B</td>
<td style="text-align: right;">3B</td>
<td style="text-align: right;">23B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">facebook.com</td>
<td style="text-align: right;">113B</td>
<td style="text-align: right;">2B</td>
<td style="text-align: right;">13B</td>
</tr>
<tr class="even">
<td style="text-align: left;">tiktok.com</td>
<td style="text-align: right;">49B</td>
<td style="text-align: right;">1B</td>
<td style="text-align: right;">3B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">instagram.com</td>
<td style="text-align: right;">15B</td>
<td style="text-align: right;">296M</td>
<td style="text-align: right;">1B</td>
</tr>
<tr class="even">
<td style="text-align: left;">airbnb.com</td>
<td style="text-align: right;"><strong>357M</strong></td>
<td style="text-align: right;"><strong>17M</strong></td>
<td style="text-align: right;"><strong>31M</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;">vrbo.com</td>
<td style="text-align: right;"><strong>37M</strong></td>
<td style="text-align: right;"><strong>4M</strong></td>
<td style="text-align: right;"><strong>7M</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">uber.com</td>
<td style="text-align: right;">6M</td>
<td style="text-align: right;">2M</td>
<td style="text-align: right;">3M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lyft.com</td>
<td style="text-align: right;">5M</td>
<td style="text-align: right;">2M</td>
<td style="text-align: right;">2M</td>
</tr>
</tbody>
</table>
</div>
<p>Now that we’ve accumulated some insights, let’s think about how we might present the results of our data analysis to our colleagues.</p>
</section>
<section id="build-reports-and-dashboards-with-quarto" class="level2">
<h2 class="anchored" data-anchor-id="build-reports-and-dashboards-with-quarto">Build Reports and Dashboards with Quarto</h2>
<p>Duration: 2</p>
<p>We’ve conveniently written our analysis in a Quarto (.qmd) document, <a href="https://github.com/posit-dev/snowflake-posit-quickstart-r/blob/main/quarto.qmd">quarto.qmd</a>. <a href="https://quarto.org/">Quarto</a> is an open-source publishing system that makes it easy to create <a href="https://quarto.org/docs/guide/">data products</a> such as <a href="https://quarto.org/docs/output-formats/html-basics.html">documents</a>, <a href="https://quarto.org/docs/presentations/">presentations</a>, <a href="https://quarto.org/docs/dashboards/">dashboards</a>, <a href="https://quarto.org/docs/websites/">websites</a>, and <a href="https://quarto.org/docs/books/">books</a>.</p>
<p>By placing our work in a Quarto document, we have interwoven all of our code, results, output, and prose text into a single literate programming document. This way everything can travel together in a reproducible data product.</p>
<p>A Quarto document can be thought of as a regular markdown document, but with the ability to run code chunks.</p>
<p>You can run any of the code chunks by clicking the play button above the chunk in the RStudio Pro IDE.</p>
<p><img src="assets/quarto/run-chunk.png" class="img-fluid"></p>
<p>You can render the entire document into a polished report to share, with the <code>Render</code> button.</p>
<p><img src="assets/quarto/rstudio-render.png" class="img-fluid"></p>
<p>This will run all the code in the document from top to bottom in a new R session, and generate an HTML file, by default, for you to view and share.</p>
<section id="learn-more-about-quarto" class="level3">
<h3 class="anchored" data-anchor-id="learn-more-about-quarto">Learn More about Quarto</h3>
<p>You can learn more about Quarto here: <a href="https://quarto.org/" class="uri">https://quarto.org/</a>, and the documentation for all the various Quarto outputs here: <a href="https://quarto.org/docs/guide/" class="uri">https://quarto.org/docs/guide/</a>. Quarto works with R, Python, and Javascript Observable code out-of-the box, and is a great tool to communicate your data science analyses.</p>
</section>
</section>
<section id="shiny-application" class="level2">
<h2 class="anchored" data-anchor-id="shiny-application">Shiny Application</h2>
<p>Duration: 2</p>
<p>Our visual analysis compared two specific websites: airbnb.com and vrbo.com, but we could reuse the code to compare any combination of websites. An efficient way to do this is with an interactive <a href="https://shiny.posit.co/">Shiny</a> app.</p>
<p>We’ve prepared an example Shiny app in the directory: <a href="https://github.com/posit-dev/snowflake-posit-quickstart-r" class="uri">https://github.com/posit-dev/snowflake-posit-quickstart-r</a></p>
<p><img src="assets/shiny/shiny.png" class="img-fluid"></p>
<p>To run the app, open <code>app.R</code> and then click the Run App button at the top of the script in the RStudio Pro IDE.</p>
<p><img src="assets/shiny/run.png" class="img-fluid"></p>
<p>To use the app, update the domains and date range in the sidebar. The app will respond automatically by updating its plot, table, and value boxes.</p>
<section id="learn-more-about-shiny" class="level3">
<h3 class="anchored" data-anchor-id="learn-more-about-shiny">Learn More About Shiny</h3>
<p>You can learn more about Shiny at: <a href="https://shiny.posit.co/" class="uri">https://shiny.posit.co/</a>. This example uses Shiny for R, but <a href="https://shiny.posit.co/py/">Shiny for Python</a> is also available!</p>
<p>If you’re new to Shiny, you can try it online with <a href="https://shinylive.io/">shinylive</a>. It too, comes in a <a href="https://shinylive.io/py">Python</a> version.</p>
</section>
</section>
<section id="conclusion-and-resources" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-and-resources">Conclusion and Resources</h2>
<p>Duration: 2</p>
<p>R is beloved by data scientists for its intuitive, concise syntax. You can now combine this syntax with the power and peace of mind of Snowflake. The Posit Workbench Native Application provides an IDE for R <em>within Snowflake</em>. You can then use R’s existing database packages—<code>{DBI}</code>, <code>{odbc}</code>, <code>{dbplyr}</code>—to access your Snowflake databases.</p>
<section id="what-you-learned" class="level3">
<h3 class="anchored" data-anchor-id="what-you-learned">What You Learned</h3>
<ul>
<li>How to create an R session within the RStudio Pro IDE that comes with the Posit Workbench Native App</li>
<li>How to connect to your Snowflake data from R to create tables, visualizations, and more</li>
<li>Build an RStudio Pro IDE environment to use within Snowflake</li>
<li>Build a Quarto document that contains plots and tables built with R, using data available in the Snowflake Marketplace.</li>
<li>Build an interactive Shiny Application built with R, using data available in the Snowflake Marketplace</li>
</ul>
</section>
<section id="releated-resources" class="level3">
<h3 class="anchored" data-anchor-id="releated-resources">Releated Resources</h3>
<ul>
<li><a href="https://github.com/posit-dev/snowflake-posit-quickstart-r">Source Code on GitHub</a></li>
<li><a href="https://posit.co/products/enterprise/workbench/">More about Posit Workbench</a></li>
<li><a href="https://dbplyr.tidyverse.org/">{tidyverse} package for data science in R</a></li>
<li><a href="https://dbplyr.tidyverse.org/">{dbplyr} package for database connections</a></li>
<li><a href="https://gt.rstudio.com/">{gt} package for tables</a></li>
<li><a href="https://quarto.org/">Quarto for reproducible documents, reports, and data products</a></li>
<li><a href="https://shiny.posit.co/">Shiny for interactive dashboards and applications</a></li>
<li><a href="https://shinylive.io/">Shinylive for serverless Shiny applications</a></li>
</ul>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>